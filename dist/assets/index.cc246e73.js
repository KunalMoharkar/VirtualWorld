import{P as V,O as b,V as m,Q as f,T as j,M as g,F as G,W as Q,B as D,a as h,b as A,c as _,d as F,R as z,S as Z,e as $,f as q,g as K,h as J,A as ee,D as te,H as oe,i as ae,j as se,k as ne,l as re}from"./vendor.d153eaed.js";const ie=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const c of n.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&i(c)}).observe(document,{childList:!0,subtree:!0});function a(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerpolicy&&(n.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?n.credentials="include":s.crossorigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(s){if(s.ep)return;s.ep=!0;const n=a(s);fetch(s.href,n)}};ie();class de{camera;model;motion;velocity;position;animationState;location;lookSpeedX;lookSpeedY;constructor({FOV:t,aspect:a,near:i,far:s},n){this.camera=new V(t,a,i,s),this.camera.name="PlayerCam",this.model=new b,this.model.add(this.camera);const c=new b;c.name="PlayerMesh",c.position.y+=.5,this.model.add(c),this.position=new m(0,0,0),this.motion={forward:!1,left:!1,reverse:!1,right:!1,mouseNormalX:0,mouseNormalY:0,mousecapture:!1},this.velocity=0,this.animationState="idle",this.location=n,this.initControls(),this.lookSpeedX=this.lookSpeedY=1e-5}setCameraPosition(t){this.camera.position.copy(t)}addModel(t){this.model.getObjectByName("PlayerMesh")?.add(t)}initControls(){document.addEventListener("keydown",t=>{switch(t.key){case"w":this.motion.forward=!0,this.animationState="accelerating";break;case"a":this.motion.left=!0;break;case"s":this.motion.reverse=!0,this.animationState="decelerating";break;case"d":this.motion.right=!0}}),document.addEventListener("keypress",t=>{switch(t.key){case"c":this.motion.mousecapture=!this.motion.mousecapture,this.motion.mouseNormalX=0,this.motion.mouseNormalY=0}}),document.addEventListener("keyup",t=>{switch(t.key){case"w":this.motion.forward=!1,this.animationState="idle";break;case"a":this.motion.left=!1;break;case"s":this.motion.reverse=!1,this.animationState="idle";break;case"d":this.motion.right=!1;break}}),document.addEventListener("pointermove",t=>{if(this.motion.mousecapture){const a=(t.clientX-window.innerWidth/2)*2-1,i=-((t.clientY-window.innerHeight/2)*2-1);this.motion.mouseNormalX=-a,this.motion.mouseNormalY=i}}),document.addEventListener("touchstart",t=>{this.lookSpeedX=this.lookSpeedY=3e-5})}motionUpdate(){this.motion.forward&&(this.velocity+=.01),this.motion.left&&this.model.rotateY(.02),this.motion.right&&this.model.rotateY(-.02),this.motion.reverse&&(this.velocity-=.01);let t=new f,a=new f;t.setFromAxisAngle(new m(0,1,0),this.motion.mouseNormalX*this.lookSpeedX),a.setFromAxisAngle(new m(1,0,0),this.motion.mouseNormalY*this.lookSpeedY),this.model.applyQuaternion(t),this.camera.applyQuaternion(a)}animate(){const t=this.model.getObjectByName("PlayerMesh");switch(this.animationState){case"accelerating":{const a=new f;a.setFromAxisAngle(new m(1,0,0),-Math.PI/6),t.quaternion.slerp(a,.1);break}case"decelerating":{const a=new f;a.setFromAxisAngle(new m(1,0,0),Math.PI/6),t.quaternion.slerp(a,.1);break}case"idle":{const a=new f;a.setFromAxisAngle(new m(1,0,0),0),t.quaternion.slerp(a,.1);break}}}update(){this.motionUpdate(),this.animate(),this.model.translateZ(-this.velocity),this.velocity*=.8}}const le="res/textures/grass/Grass_01.png",ce="res/textures/grass/Grass_01_Nrm.png",me="res/models/avatar/source/eve.fbx",he="res/shaders/sky/sky.frag",ue="res/shaders/sky/sky.vert",pe=document.querySelector("#app"),r={time:document.querySelector("#time"),location:document.querySelector("#location"),modal:document.querySelector("#modal"),controls:{w:document.querySelector("#w"),a:document.querySelector("#a"),s:document.querySelector("#s"),d:document.querySelector("#d"),mouseCapture:document.querySelector("#capture")}};function we(){r.modal.addEventListener("click",e=>{r.modal.classList.remove("appear-grow")})}we();const E=new ne,R=new j,y=R.load(le);y.wrapS=g;y.wrapT=g;y.repeat.set(64,64);const S=R.load(ce);S.wrapS=g;S.wrapT=g;S.repeat.set(64,64);const X=new G,x=new b,fe={trees:"/res/models/trees/",props:"/res/models/props/",buildings:"/res/models/buildings/",mobs:"/res/models/mobs/"},ge=["BirchTree_1.fbx","BirchTree_2.fbx","CommonTree_3.fbx","CommonTree_4.fbx","Willow_1.fbx"],u=new Q({antialias:window.devicePixelRatio<=1,powerPreference:"high-performance"});u.shadowMap.enabled=!0;u.shadowMap.type=D;u.setSize(window.innerWidth,window.innerHeight);u.setPixelRatio(window.devicePixelRatio);pe.appendChild(u.domElement);let p=0;const o=new de({FOV:60,aspect:window.innerWidth/window.innerHeight,near:.1,far:1e3},"Forest");o.camera.position.set(0,1,0);["mousedown","touchstart"].forEach(e=>{r.controls.w.addEventListener(e,t=>{o.motion.forward=!0,o.animationState="accelerating"}),r.controls.a.addEventListener(e,t=>{o.motion.left=!0}),r.controls.s.addEventListener(e,t=>{o.motion.reverse=!0,o.animationState="decelerating"}),r.controls.d.addEventListener(e,t=>{o.motion.right=!0})});["mouseup","touchend"].forEach(e=>{r.controls.w.addEventListener(e,t=>{o.motion.forward=!1,o.animationState="idle"}),r.controls.a.addEventListener(e,t=>{o.motion.left=!1}),r.controls.s.addEventListener(e,t=>{o.motion.reverse=!1,o.animationState="idle"}),r.controls.d.addEventListener(e,t=>{o.motion.right=!1})});r.controls.mouseCapture.addEventListener("click",e=>{o.motion.mousecapture=!o.motion.mousecapture,r.controls.mouseCapture.innerText="Press C to stop"});document.addEventListener("keypress",e=>{e.key=="c"&&(r.controls.mouseCapture.innerText="Start Mouse Capture")});o.model.castShadow=!0;const ye=new h(new A(.1,.1,.1,1,1,1),new _({color:16777215})),P=new F(65821,.3);ye.add(P);o.addModel(P);P.position.set(0,0,0);o.setCameraPosition(new m(0,1,2));X.load(me,e=>{e.rotateY(Math.PI),e.scale.set(.1,.1,.1),o.addModel(e)});const Y=new z(void 0,void 0,void 0,5),l=new Z;l.fog=new $(255,.02);l.add(o.model);const v=new h(new q(1),new _({color:16711680}));v.name="target";l.add(v);v.position.set(10,1,10);const H=new Float32Array(4);H.set([0,0,1,1]);const I=new K({fragmentShader:await fetch(he).then(e=>e.text()),vertexShader:await fetch(ue).then(e=>e.text()),uniforms:{time:{value:p},fogDensity:{value:.02},fogColor:{value:H}},side:J,fog:!1}),O=new h(new q(100,40,40),I);O.name="skyball";l.add(O);function Se(){const e=new A(.05,.05,.05,1,1,1),t=new re({color:15790320,emissive:16777215}),a=new h(e,t);return a.add(new F(986895,.1)),{model:a,radius:5+Math.random()*5,angularSpeed:Math.random()*.01,frequency:Math.random()*.01}}let B=[];function ve(){for(let e=0;e<5;e++){let t=Se();B.push(t),l.add(t.model)}}ve();async function Me(){let e=[],t=[];for(let i of ge){const s=X.loadAsync(`${fe.props}${i}`);t.push(s)}e=await Promise.all(t),e.forEach(i=>i.scale.set(.02,.02,.02));const a=20;for(let i=0;i<a;i++){let s=Math.floor(Math.random()*e.length),n=e[s];n.position.set(Math.random()*10,0,Math.random()*10);const c=2,U=20,T=10;let C=0;for(;Math.min(...x.children.map(w=>n.position.distanceTo(w.position)))<c&&(n.position.set((Math.random()-.5)*2*T,0,(Math.random()-.5)*2*T),C+=1,!(C>U)););n.castShadow=!0,n.traverse(w=>{w.castShadow=!0,w instanceof h&&w.geometry.computeVertexNormals()});let N=n.clone();N.rotateY(Math.random()*2*Math.PI),x.add(N)}return x}Me().then(e=>l.add(e));const Le=new ee(5263440,1);l.add(Le);const d=new te(16777215,.4);d.color.setHSL(.8,.3,.2);d.position.set(0,1.75,0);d.position.multiplyScalar(40);l.add(d);d.castShadow=!0;d.shadow.mapSize.width=2048;d.shadow.mapSize.height=2048;const M=40;d.shadow.camera.left=-M;d.shadow.camera.right=M;d.shadow.camera.top=M;d.shadow.camera.bottom=-M;d.shadow.camera.far=3500;d.shadow.bias=-1e-4;const L=new oe(16777215,16777215,.2);L.color.setHSL(.8,.2,.2);L.groundColor.setHSL(.5,1,.75);L.position.set(0,50,0);l.add(L);const k=new h(new ae(200,200,256,256),new se({map:y,normalMap:S,wireframe:!1,fog:!1}));k.rotateX(-Math.PI/2);k.receiveShadow=!0;k.castShadow=!1;l.add(k);document.addEventListener("click",e=>{E.x=e.clientX/window.innerWidth*2-1,E.y=-(e.clientY/window.innerHeight)*2+1,Y.setFromCamera(E,o.camera),Y.intersectObject(v).length&&(r.modal.classList.add("appear-grow"),r.modal.innerText="INTERACTIVE CONTENT HERE")});function ke(){I.uniforms.time.value=p}function be(){B.forEach(e=>{e.model.position.set(e.radius*Math.cos(e.angularSpeed*p),.5+.5*Math.sin(e.frequency*2*Math.PI*p),e.radius*Math.sin(e.angularSpeed*p))})}function Ee(){o.update(),be(),ke()}function W(){u.render(l,o.camera),p+=1,Ee(),window.requestAnimationFrame(W)}W();
